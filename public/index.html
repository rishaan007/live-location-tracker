<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Location with MapLibre & MapTiler</title>
  <link
    href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css"
    rel="stylesheet"
  />
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .mapboxgl-ctrl-geocoder {
      min-width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    const socket = io();

    // Initialize MapLibre with MapTiler Streets
    const map = new maplibregl.Map({
      container: "map",
      style: "https://api.maptiler.com/maps/streets/style.json?key=kASiLExSIgq3mDDTE8MZ",
      center: [0, 0],
      zoom: 2,
    });

    // Add zoom and rotation controls
    map.addControl(new maplibregl.NavigationControl(), "top-right");

    // Marker variable
    let marker;

    socket.on("locationUpdate", (data) => {
      const { latitude, longitude, address } = data;

      // Center map on user's location
      map.flyTo({ center: [longitude, latitude], zoom: 14 });

      // Add or update marker
      if (!marker) {
        marker = new maplibregl.Marker({ color: "red" })
          .setLngLat([longitude, latitude])
          .setPopup(
            new maplibregl.Popup().setHTML(`<b>Your Location:</b><br>${address}`)
          )
          .addTo(map);
      } else {
        marker.setLngLat([longitude, latitude]);
        marker.getPopup().setHTML(`<b>Your Location:</b><br>${address}`);
      }
    });
  </script>
</body>
</html>
